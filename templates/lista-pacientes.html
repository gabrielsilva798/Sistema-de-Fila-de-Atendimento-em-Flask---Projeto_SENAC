<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Pacientes na Fila</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/lista-pacientes.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>


    <aside class="sidebar">
        <h2>{{ session['empresa_nome'] }}</h2>
        <nav>
            <ul>
                <li><a href="{{ url_for('tela_principal_estabelecimento') }}"><i class="fas fa-chart-line"></i>
                        Dashboard</a></li>
                <li><a href="{{ url_for('view_cadastrar_paciente') }}"><i class="fas fa-user-plus"></i> Adicionar
                        Paciente</a></li>
                <li class="active"><a href="{{ url_for('lista_pacientes') }}"><i class="fas fa-users"></i> Lista de
                        Pacientes</a>
                </li>
                <li><a href="{{ url_for('profissionais') }}"><i class="fas fa-user-md"></i>
                        Profissionais</a></li>
                <li><a href="{{ url_for('gemini') }}"><i class="fas fa-brain"></i> Análise de Dados</a>
                </li>
                <li><a href="{{ url_for('config_empresa') }}"><i class="fas fa-cogs"></i> Configurações</a></li>
                <li><a href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Sair</a></li>
            </ul>
        </nav>
    </aside>

    <main class="main-content">

        <header class="content-header">
            <h1><i class="fas fa-list-ol"></i> Fila de Espera</h1>
        </header>

        <!-- FLASH MESSAGES -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="flash-container">
            {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <div class="queue-tools">
            <input type="text" placeholder="Buscar por Nome ou CPF..." class="search-input">
            <select class="filter-select">
                <option value="">Filtrar por Risco</option>
                <option value="vermelho">Vermelho (Emergência)</option>
                <option value="laranja">Laranja (Urgente)</option>
                <option value="amarelo">Amarelo (Atenção)</option>
                <option value="verde">Verde (Baixo risco)</option>
            </select>
            <button class="btn-refresh"><i class="fas fa-sync-alt"></i> Atualizar Fila</button>
        </div>

        <div class="patient-list-container">

            {% if fila %}
            <table class="patient-table">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>CPF</th>
                        <th>Classificação</th>
                        <th>Chegada</th>
                        <th>Ação</th>
                    </tr>
                </thead>

                <tbody>
                    {% for p in fila %}
                    <tr>
                        <td>{{ p.nome }}</td>
                        <td>{{ p.cpf }}</td>
                        <td class="class-{{ p.classificacao }}">{{ p.classificacao.capitalize() }}</td>
                        <td>
                            {% if p.chegada %}
                            {{ p.chegada.strftime('%d/%m/%Y %H:%M') }}
                            {% else %}
                            -
                            {% endif %}
                        </td>

                        <td>
                            <form action="{{ url_for('iniciar_atendimento_route', fila_id=p.fila_id) }}" method="POST">
                                <button class="btn-action start">Iniciar Atendimento</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            {% else %}
            <p class="empty">Nenhum paciente na fila.</p>
            {% endif %}

        </div>

    </main>

    <!-- SocketIO -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="{{ url_for('static', filename='js/socket-client.js') }}"></script>

</body>

</html>