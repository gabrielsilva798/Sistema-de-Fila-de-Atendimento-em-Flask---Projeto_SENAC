<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Pacientes | MOVIDA</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/lista-pacientes.css') }}">
</head>

<body>

<div class="layout">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <h2>{{ session['empresa_nome'] }}</h2>

        <ul>
            <li><a href="{{ url_for('tela_principal_estabelecimento') }}">üè• Painel</a></li>
            <li><a href="{{ url_for('view_cadastrar_paciente') }}">üìù Cadastrar Paciente</a></li>
            <li><a class="active" href="{{ url_for('lista_pacientes') }}">üìã Lista de Pacientes</a></li>
            <li><a href="{{ url_for('config_empresa') }}">‚öôÔ∏è Configura√ß√µes</a></li>
            <li><a href="{{ url_for('logout') }}" class="logout">‚èª Sair</a></li>
        </ul>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="content">

        <h1>Pacientes na Fila</h1>

        <!-- FLASH MESSAGES -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <div class="flash-container">
                {% for category, message in messages %}
                    <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
            {% endif %}
        {% endwith %}

        <div class="table-container">

            {% if fila %}
            <table>
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>CPF</th>
                        <th>Classifica√ß√£o</th>
                        <th>Chegada</th>
                        <th>A√ß√£o</th>
                    </tr>
                </thead>

                <tbody>
                    {% for p in fila %}
                    <tr>
                        <td>{{ p.nome }}</td>
                        <td>{{ p.cpf }}</td>
                        <td class="class-{{ p.classificacao }}">{{ p.classificacao.capitalize() }}</td>
                        <td>
                            {% if p.chegada %}
                                {{ p.chegada.strftime('%d/%m/%Y %H:%M') }}
                            {% else %}
                                -
                            {% endif %}
                        </td>

                        <td>
                            <form action="{{ url_for('iniciar_atendimento_route', fila_id=p.fila_id) }}" method="POST">
                                <button class="btn-start">Iniciar Atendimento</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            {% else %}
            <p class="empty">Nenhum paciente na fila.</p>
            {% endif %}

        </div>

    </main>

</div>

<!-- SocketIO -->
<script src="/socket.io/socket.io.js"></script>
<script src="{{ url_for('static', filename='js/socket-client.js') }}"></script>

</body>
</html>
